[gd_scene load_steps=4 format=3 uid="uid://b3qxmwtlwyypy"]

[ext_resource type="Texture2D" uid="uid://bgv55ofuh5bvl" path="res://sprites/pvv_peablasting.png" id="2_ocqhm"]

[sub_resource type="GDScript" id="GDScript_2t34w"]
script/source = "extends Node2D

var bullet_speed = 150
var hit = false
var rng = RandomNumberGenerator.new()
var direction

func _physics_process(delta):
	if !hit:
		self.position.x += global.speed * bullet_speed * delta
	else:
		self.position = self.position.move_toward(direction, global.speed * 1.5 * delta * self.position.distance_to(direction))

func _on_bullet_area_2_area_entered(area):
	if area.name == \"enemy\" and !hit:
		direction = Vector2(self.position.x + rng.randf_range(-20, 50), self.position.y + rng.randf_range(-50, 50))
		hit = true
		var particleee = load(\"res://scenes/particles_square.tscn\").instantiate()
		get_parent().add_child(particleee)
		particleee.position = self.position
		particleee.get_child(0).amount = 3
		particleee.get_child(0).emitting = true
		particleee.get_child(0).initial_velocity_min = 15
		particleee.get_child(0).initial_velocity_max = 25
		particleee.get_child(0).gravity.y = 20
		particleee.get_child(0).z_index = 10
		particleee.get_child(0).direction.x = -1
		particleee.get_child(0).direction.y = -1
		particleee.get_child(0).scale_amount_max = 4
		
	elif area.name == \"enemy\" and hit:
		var particleee = load(\"res://scenes/particles_square.tscn\").instantiate()
		get_parent().add_child(particleee)
		particleee.position = self.position
		particleee.get_child(0).amount = 3
		particleee.get_child(0).emitting = true
		particleee.get_child(0).initial_velocity_min = 15
		particleee.get_child(0).initial_velocity_max = 25
		particleee.get_child(0).gravity.y = 20
		particleee.get_child(0).z_index = 10
		particleee.get_child(0).direction.x = -1
		particleee.get_child(0).direction.y = -1
		particleee.get_child(0).scale_amount_max = 4
		self.queue_free()

func _on_timer_timeout():
	self.queue_free()

"

[sub_resource type="CircleShape2D" id="CircleShape2D_kh5dn"]
radius = 7.0

[node name="pea_pea_bullet" type="Node2D"]
script = SubResource("GDScript_2t34w")

[node name="pvv_peablasting" type="Sprite2D" parent="."]
modulate = Color(0.378, 0.9, 0.4128, 1)
texture = ExtResource("2_ocqhm")
hframes = 5
vframes = 2
frame = 5

[node name="bullet_area2" type="Area2D" parent="."]

[node name="CollisionShape2D" type="CollisionShape2D" parent="bullet_area2"]
shape = SubResource("CircleShape2D_kh5dn")

[node name="Timer" type="Timer" parent="."]
wait_time = 10.0
autostart = true

[connection signal="area_entered" from="bullet_area2" to="." method="_on_bullet_area_2_area_entered"]
[connection signal="timeout" from="Timer" to="." method="_on_timer_timeout"]
