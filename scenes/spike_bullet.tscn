[gd_scene load_steps=5 format=3 uid="uid://dr14781wmvjg1"]

[ext_resource type="Texture2D" uid="uid://bgv55ofuh5bvl" path="res://sprites/pvv_peablasting.png" id="2_rsos5"]

[sub_resource type="GDScript" id="GDScript_3owou"]
script/source = "extends Node2D

@onready var detection_area = $detection_area
@onready var detection_area_collision = $detection_area/CollisionShape2D
var bullet_speed = 100
var rng = RandomNumberGenerator.new()
var min_dis
var min_area
var hit = 0

func _physics_process(delta):
	min_dis = 10000
	min_area = null
	for area in detection_area.get_overlapping_areas():
		if min_dis > self.position.distance_to(area.get_parent().position) and (area.name == \"enemy\" or area.name == \"enemy_fly\"):
			min_dis = self.position.distance_to(area.get_parent().position)
			min_area = area.get_parent().position
	#if min_area != null:
		#print(\"rotation: \" + str(self.rotation))
		#print(self.position.angle_to_point(min_area))
		#print(self.rotation + (PI))
		#print(((-2 * PI) - self.rotation) - self.position.angle_to_point(min_area))
	if min_area != null and self.position.angle_to_point(min_area) > -1.56 and self.rotation > -1.57:
		self.rotation += (self.position.angle_to_point(min_area) - self.rotation) * delta * global.speed * 3
	elif min_area != null and self.position.angle_to_point(min_area) < -1.56 and self.rotation > 0:
		self.rotation += (abs(self.position.angle_to_point(min_area) - (self.rotation - (PI * 2)))) * delta * global.speed * 3
	elif min_area != null and self.position.angle_to_point(min_area) < -1.56 and self.rotation <= 0:
		self.rotation += (self.position.angle_to_point(min_area) - (self.rotation)) * delta * global.speed * 3
	elif min_area != null and self.position.angle_to_point(min_area) > -1.56 and self.rotation <= -1.57:
		self.rotation = self.rotation + (2 * PI)
	self.position += global.speed * bullet_speed * delta * Vector2(cos(self.rotation), sin(self.rotation))
	
	if hit > 1:
		var particleee = load(\"res://scenes/particles_square.tscn\").instantiate()
		get_parent().add_child(particleee)
		particleee.position = self.position
		particleee.get_child(0).color = Color(1, 0.37, 0.37, 1)
		particleee.get_child(0).amount = 3
		particleee.get_child(0).emitting = true
		particleee.get_child(0).initial_velocity_min = 15
		particleee.get_child(0).initial_velocity_max = 25
		particleee.get_child(0).gravity.y = 20
		particleee.get_child(0).z_index = 10
		particleee.get_child(0).direction.x = 0
		particleee.get_child(0).direction.y = 0
		particleee.get_child(0).scale_amount_max = 8
		self.queue_free()

func _on_bullet_area_3_area_entered(area):
	if area.name == \"enemy\":
		var particleee = load(\"res://scenes/particles_square.tscn\").instantiate()
		get_parent().add_child(particleee)
		particleee.position = self.position
		particleee.get_child(0).color = Color(1, 0.37, 0.37, 1)
		particleee.get_child(0).amount = 3
		particleee.get_child(0).emitting = true
		particleee.get_child(0).initial_velocity_min = 15
		particleee.get_child(0).initial_velocity_max = 25
		particleee.get_child(0).gravity.y = 20
		particleee.get_child(0).z_index = 10
		particleee.get_child(0).direction.x = 0
		particleee.get_child(0).direction.y = 0
		particleee.get_child(0).scale_amount_max = 4
		self.queue_free()
	if area.name == \"enemy_fly\":
		hit += 1
	
func _on_timer_timeout():
	self.queue_free()

"

[sub_resource type="CircleShape2D" id="CircleShape2D_kfnd0"]

[sub_resource type="CircleShape2D" id="CircleShape2D_pkx7g"]
radius = 1000.0

[node name="spike_bullet" type="Node2D"]
script = SubResource("GDScript_3owou")

[node name="pvv_peablasting" type="Sprite2D" parent="."]
modulate = Color(1, 0.236504, 0.254572, 1)
texture = ExtResource("2_rsos5")
hframes = 5
vframes = 2
frame = 8

[node name="bullet_area3" type="Area2D" parent="."]
z_index = -1

[node name="bullet_collision" type="CollisionShape2D" parent="bullet_area3"]
shape = SubResource("CircleShape2D_kfnd0")

[node name="Timer" type="Timer" parent="."]
wait_time = 20.0
autostart = true

[node name="detection_area" type="Area2D" parent="."]
z_index = -21

[node name="CollisionShape2D" type="CollisionShape2D" parent="detection_area"]
shape = SubResource("CircleShape2D_pkx7g")

[connection signal="area_entered" from="bullet_area3" to="." method="_on_bullet_area_3_area_entered"]
[connection signal="timeout" from="Timer" to="." method="_on_timer_timeout"]
